# DeepSeek桥接脚本使用说明

## 简介

`deepseek_bridge.py`是一个Python脚本，用于连接STM32-PetCare系统与DeepSeek API。它通过串口接收STM32发送的查询请求，调用DeepSeek API获取响应，并将响应发送回STM32设备。

## 使用前准备

### 1. 安装必要的Python库

```bash
pip install pyserial requests
```

### 2. 配置脚本参数

在`deepseek_bridge.py`文件中，修改以下配置参数：

```python
# 配置参数
SERIAL_PORT = 'COM3'  # 根据实际蓝牙串口修改
BAUDRATE = 9600
DEEPSEEK_API_KEY = 'sk-94432043ca50474083056112bcfe26b5'  # 替换为你的DeepSeek API密钥
```

- `SERIAL_PORT`：设置为HC05蓝牙模块对应的串口
  - Windows系统通常为`COM`开头，如`COM3`
  - Linux系统通常为`/dev/tty`开头，如`/dev/ttyUSB0`
  - macOS系统通常为`/dev/tty.`开头，如`/dev/tty.usbserial`
- `BAUDRATE`：波特率，默认为9600，与STM32端配置保持一致
- `DEEPSEEK_API_KEY`：你的DeepSeek API密钥

### 3. 确保STM32设备已正确配置

- 确保STM32已烧录正确的固件
- 确保HC05蓝牙模块已正确连接并初始化
- 确保电脑已与HC05蓝牙模块配对成功

## 运行脚本

```bash
python deepseek_bridge.py
```

脚本启动后，将显示以下信息：

```
成功连接到串口 COM3
等待STM32发送DeepSeek查询请求...
当前串口配置: 端口=COM3, 波特率=9600
```

## 使用方法

1. 在STM32设备上，通过蓝牙发送以下格式的命令：
   ```
   +deepseek 你的问题内容
   ```
   例如：`+deepseek 今天天气怎么样？`

2. STM32将通过蓝牙发送查询请求到电脑

3. 桥接脚本接收请求，调用DeepSeek API，并将响应发送回STM32

4. STM32接收响应并在LCD上显示

## 调试信息

脚本运行时会输出详细的调试信息，帮助你了解通信过程：

```
收到: DeepSeek Query: 今天天气怎么样？
处理查询: 今天天气怎么样？
正在调用DeepSeek API，查询内容: 今天天气怎么样？
API响应: 我无法提供实时的天气信息，因为我没有访问当前天气数据的能力。要获取今天的天气情况，您可以：

1. 查看天气应用或网站
2. 搜索引擎搜索"[您所在城市]天气"
3. 查看当地气象部门网站
4. 收听广播或电视天气预报

如果您告诉我您所在的具体位置，我也无法提供准确的天气信息，因为我没有实时联网能力。
已发送响应到STM32
```

## 故障排除

1. **串口连接失败**
   - 检查串口名称是否正确
   - 确保蓝牙已正确配对
   - 确保没有其他程序占用该串口

2. **API调用失败**
   - 检查API密钥是否正确
   - 检查网络连接是否正常
   - 查看控制台输出的错误信息

3. **STM32没有收到响应**
   - 检查蓝牙连接是否稳定
   - 检查响应内容是否过长（可能需要分段发送）
   - 尝试发送简短的测试消息

## 注意事项

- 确保DeepSeek API密钥有效且有足够的调用额度
- 蓝牙通信可能存在延迟，请耐心等待响应
- 如果响应内容过长，可能需要分段发送，当前实现可能需要根据实际情况调整
- 按Ctrl+C可以终止脚本运行